import{a as x,d as T}from"./api-D2L8GIA_.js";import{w as f}from"./webStorage-CD_LUw1r.js";import{_ as G,r as U,f as p,g as B,h as H,b as t,w as o,F as R,e as d,o as D,d as s,t as k,i as F,a as A,c as W}from"./index-DWF53CTv.js";import{_ as J}from"./logo--sImDoQO.js";const u=new T,K={setup(){f.getItem("token")===void 0&&U.push("/login");const e=p(""),n=p([]),l=p(""),m=p([]),r=p(""),c=p([]),b=p({}),C=p(!1),_=[{title:"远程主机",width:"150px",key:"remoteHost"},{title:"远程端口",width:"100px",key:"remotePort"},{title:"代理端口",width:"100px",key:"serverPort"},{title:"允许网段",width:"120px",key:"allowNetworks",customSlot:"allowNetworksSlot"},{title:"已连接客户端",width:"120px",key:"clientOutletIps",customSlot:"clientOutletIpsSlot"},{title:"备注",width:"300px",key:"remark",ellipsisTooltip:!0},{title:"操作",width:"50px",customSlot:"proxyOperator"}],h=p([]),O=B({}),y=p(!1),N=p(),S=[{title:"日志路径",width:"150px",key:"filePath"},{title:"监听时长（分钟）",width:"50px",key:"expire"},{title:"操作",width:"50px",customSlot:"logOperator"}],q=p([]),w=B({}),P=p(!1),M=p(),L=p(""),v=[{title:"类名",width:"750px",key:"className"},{title:"操作",width:"50px",customSlot:"codeOperator"}],g=p([]),I=p([]);return{appValue:e,appItem:n,clientIpValue:l,clientIpItem:m,clientIdValue:r,clientIdItem:c,appInfo:b,selectLock:C,proxyColumns:_,proxyDataSource:h,proxyModel:O,addProxyOpen:y,proxyModelRef:N,logColumns:S,logDataSource:q,logModel:w,addLogOpen:P,logModelRef:M,codeSearch:L,codeColumns:v,codeDataSource:g,codeAllDataSource:I}},data(){return{}},methods:{debug(){let a=f.getItem("clients");if(this.clientIdValue!==""){for(let e=0;e<a.length;e++)a[e].uniqueId===this.clientIdValue&&(this.appInfo.socketClientHost=a[e].socketClientHost,this.appInfo.socketClientOutletIp=a[e].socketClientOutletIp,this.appInfo.pid=a[e].pid,this.appInfo.jdwpPort=a[e].jdwpPort,a[e].debug4jMode==="process"?this.appInfo.processSession=a[e].clientSessionId:this.appInfo.threadSession=a[e].clientSessionId);if(this.selectLock=!this.selectLock,!this.selectLock)this.appInfo.socketClientHost="",this.appInfo.socketClientOutletIp="",this.appInfo.pid="",this.appInfo.jdwpPort="",this.appInfo.processSession="",this.appInfo.threadSession="",f.clear("appInfo"),this.proxyDataSource=[],this.logDataSource=[],this.codeDataSource=[];else{this.appInfo.appValue=this.appValue,this.appInfo.appItem=this.appItem,this.appInfo.clientIpValue=this.clientIpValue,this.appInfo.clientIpItem=this.clientIpItem,this.appInfo.clientIdValue=this.clientIdValue,this.appInfo.clientIdItem=this.clientIdItem,this.appInfo.selectLock=this.selectLock,f.setItem("appInfo",this.appInfo),this.loadProxy(),this.loadLog(),this.loadClass();let e={clientSessionId:this.appInfo.threadSession};x.ping(e).then(()=>{u.success("已向客户端发送日志：receive ping uniqueId: "+this.appInfo.clientIdValue)}).catch(()=>{u.warning("客户端Ping失败，请刷新页面重试！")})}}else u.warning("请先选择应用客户端！")},clientIpChange(){let a=f.getItem("clients");this.clientIdValue="",this.clientIdItem=[];for(let e=0;e<a.length;e++)if(a[e].applicationName===this.appValue&&a[e].socketClientIp===this.clientIpValue){let n={label:a[e].uniqueId,value:a[e].uniqueId};this.clientIdItem.some(l=>l.label===n.label&&l.value===n.value)||this.clientIdItem.push(n)}},appChange(){let a=f.getItem("clients");this.clientIpValue="",this.clientIpItem=[],this.clientIdValue="",this.clientIdItem=[];for(let e=0;e<a.length;e++)if(a[e].applicationName===this.appValue){let n={label:a[e].socketClientIp,value:a[e].socketClientIp};this.clientIpItem.some(l=>l.label===n.label&&l.value===n.value)||this.clientIpItem.push(n)}},loadClients(){x.getClients().then(a=>{f.clear("clients"),f.setItem("clients",a.data.data),this.review(),this.loadProxy(),this.loadLog(),this.loadClass();let e=f.getItem("clients");this.appItem=[];for(let n=0;n<e.length;n++){let l={label:e[n].applicationName,value:e[n].applicationName};this.appItem.some(m=>m.label===l.label&&m.value===l.value)||this.appItem.push(l)}}).catch(()=>{u.warning("客户端获取失败，请刷新页面重试！")})},review(){let a=f.getItem("appInfo");if(a!==void 0){let e=f.getItem("clients"),n=!0;for(let l=0;l<e.length;l++)e[l].uniqueId===a.clientIdValue&&(n=!1,e[l].debug4jMode==="process"?a.processSession=e[l].clientSessionId:a.threadSession=e[l].clientSessionId);n||(this.appInfo=a,this.appValue=this.appInfo.appValue,this.appItem=this.appInfo.appItem,this.clientIpValue=this.appInfo.clientIpValue,this.clientIpItem=this.appInfo.clientIpItem,this.clientIdValue=this.appInfo.clientIdValue,this.clientIdItem=this.appInfo.clientIdItem,this.selectLock=this.appInfo.selectLock)}},loadProxy(){this.appInfo.processSession!==void 0&&x.getProxy(this.appInfo.processSession).then(a=>{this.proxyDataSource=a.data.data}).catch(()=>{u.warning("客户端代理获取失败，请刷新页面重试！")})},addProxyClick(){this.selectLock?(this.addProxyOpen=!this.addProxyOpen,this.proxyModel.remoteHost="",this.proxyModel.remotePort="",this.proxyModel.serverPort="",this.proxyModel.allowNetworks="",this.proxyModel.remark=""):u.warning("请先选择客户端，并点击开始调试！")},proxySubmit(){this.proxyModelRef.validate((a,e,n)=>{if(a){let l=this.proxyModel;l.allowNetworks=l.allowNetworks.split(`
`).filter(m=>m!==""),l.clientSessionId=this.appInfo.processSession,x.addProxy(l).then(()=>{this.loadProxy()}).catch(()=>{u.warning("客户端代理新增失败，请重试！")}),this.addProxyClick()}else u.warning("请完整填写代理配置！")})},proxyDelete(a,e){let n={clientSessionId:this.appInfo.processSession,remoteHost:a,remotePort:e};x.removeProxy(n).then(()=>{this.loadProxy()}).catch(()=>{u.warning("代理删除失败，请重试！")})},loadLog(){if(this.appInfo.threadSession!==void 0){let a={clientSessionId:this.appInfo.threadSession};x.getLog(a).then(e=>{this.logDataSource=e.data.data}).catch(()=>{u.warning("日志监听列表获取失败，请刷新页面重试！")})}},addLogClick(){this.selectLock?(this.addLogOpen=!this.addLogOpen,this.logModel.filePath="",this.logModel.expire=""):u.warning("请先选择客户端，并点击开始调试！")},logSubmit(){this.logModelRef.validate((a,e,n)=>{if(a){let l=this.logModel;l.clientSessionId=this.appInfo.threadSession,x.addLog(l).then(m=>{let r=!0;for(let c=0;c<m.data.data.length;c++)m.data.data[c].expire===-1&&(u.warning(m.data.data[c].filePath),r=!1);r&&(this.loadLog(),this.addLogClick())}).catch(()=>{u.warning("日志监听新增失败，请重试！")})}else u.warning("请完整填写日志监听配置！")})},logDelete(a){let e={clientSessionId:this.appInfo.threadSession,filePath:a};x.deleteLog(e).then(()=>{this.loadLog()}).catch(()=>{u.warning("日志监听删除失败，请重试！")})},logReader(a){U.push({path:"/log",query:{clientSessionId:this.appInfo.threadSession,filePath:a}})},codeSearchChange(){if(this.codeSearch!==""){this.codeDataSource=[];for(let a=0;a<this.codeAllDataSource.length;a++)if(this.codeAllDataSource[a].className.toLowerCase().includes(this.codeSearch.toLowerCase())){let e=this.codeAllDataSource[a];this.codeDataSource.push(e)}f.setItem("codeSearch",this.codeSearch)}else f.clear("codeSearch"),this.codeDataSource=this.codeAllDataSource},loadClass(){if(this.appInfo.threadSession!==void 0){let a={clientSessionId:this.appInfo.threadSession};x.getCodeClass(a).then(e=>{let n=e.data.data;n.sort();for(let m=0;m<n.length;m++)this.codeAllDataSource.push({className:n[m]});let l=f.getItem("codeSearch");l!==void 0&&(this.codeSearch=l),this.codeSearchChange()}).catch(()=>{u.warning("源码类列表获取失败，请刷新页面重试！")})}},codeReader(a){U.push({path:"/code",query:{clientSessionId:this.appInfo.threadSession,className:a}})}},mounted:function(){this.loadClients()}},Q={style:{padding:"20px"}},X={style:{padding:"20px"}};function Y(a,e,n,l,m,r){const c=d("lay-space"),b=d("lay-select"),C=d("lay-col"),_=d("lay-icon"),h=d("lay-button"),O=d("lay-badge"),y=d("lay-row"),N=d("lay-line"),S=d("lay-descriptions-item"),q=d("lay-descriptions"),w=d("lay-panel"),P=d("lay-quote"),M=d("router-link"),L=d("lay-tag"),v=d("lay-table"),g=d("lay-input"),I=d("lay-form-item"),E=d("lay-textarea"),z=d("lay-form"),j=d("lay-layer");return D(),H(R,null,[t(w,null,{default:o(()=>[t(y,{space:"20"},{default:o(()=>[t(C,{md:"6",sm:"6",xs:"6"},{default:o(()=>[t(c,null,{default:o(()=>[t(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[13]||(e[13]=[s("应用名称：")])),_:1}),t(b,{style:{width:"100%"},modelValue:l.appValue,"onUpdate:modelValue":e[0]||(e[0]=i=>l.appValue=i),items:l.appItem,options:l.appItem,"show-search":!0,onChange:r.appChange,disabled:l.selectLock},null,8,["modelValue","items","options","onChange","disabled"])]),_:1})]),_:1}),t(C,{md:"5",sm:"5",xs:"5"},{default:o(()=>[t(c,null,{default:o(()=>[t(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[14]||(e[14]=[s("客户端IP：")])),_:1}),t(b,{style:{width:"100%"},modelValue:l.clientIpValue,"onUpdate:modelValue":e[1]||(e[1]=i=>l.clientIpValue=i),items:l.clientIpItem,options:l.clientIpItem,"show-search":!0,onChange:r.clientIpChange,disabled:l.selectLock},null,8,["modelValue","items","options","onChange","disabled"])]),_:1})]),_:1}),t(C,{md:"8",sm:"8",xs:"8"},{default:o(()=>[t(c,null,{default:o(()=>[t(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[15]||(e[15]=[s("客户端ID：")])),_:1}),t(b,{style:{width:"100%"},modelValue:l.clientIdValue,"onUpdate:modelValue":e[2]||(e[2]=i=>l.clientIdValue=i),items:l.clientIdItem,options:l.clientIdItem,disabled:l.selectLock},null,8,["modelValue","items","options","disabled"])]),_:1})]),_:1}),t(C,{md:"5",sm:"5",xs:"5"},{default:o(()=>[t(c,{size:20},{default:o(()=>[t(O,{value:l.selectLock?"debugging":"",ripple:l.selectLock},{default:o(()=>[t(h,{type:l.selectLock?"danger":"primary",onClick:r.debug},{default:o(()=>[t(_,{type:"layui-icon-test"}),s(" "+k(l.selectLock?"关闭":"开启")+"调试 ",1)]),_:1},8,["type","onClick"])]),_:1},8,["value","ripple"])]),_:1})]),_:1})]),_:1}),t(N),t(y,null,{default:o(()=>[t(q,{border:!0,style:{"margin-top":"10px","font-size":"12px"}},{default:o(()=>[t(S,{label:"客户端主机名"},{default:o(()=>[s(k(l.appInfo.socketClientHost),1)]),_:1}),t(S,{label:"客户端外网IP"},{default:o(()=>[s(k(l.appInfo.socketClientOutletIp),1)]),_:1}),t(S,{label:"客户端进程ID"},{default:o(()=>[s(k(l.appInfo.pid),1)]),_:1}),t(S,{label:"远程调试端口"},{default:o(()=>[s(k(l.appInfo.jdwpPort),1)]),_:1}),t(S,{label:"线程通信session"},{default:o(()=>[s(k(l.appInfo.threadSession),1)]),_:1}),t(S,{label:"进程通信session"},{default:o(()=>[s(k(l.appInfo.processSession),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{id:"proxy"},{default:o(()=>[t(y,null,{default:o(()=>[t(M,{to:"#proxy"},{default:o(()=>[t(P,null,{default:o(()=>[t(_,{type:"layui-icon-link"}),e[16]||(e[16]=s(" 代理穿透 "))]),_:1})]),_:1})]),_:1}),t(y,{style:{"margin-top":"10px"}},{default:o(()=>[t(v,{columns:l.proxyColumns,"data-source":l.proxyDataSource,autoColsWidth:!0,even:""},{allowNetworksSlot:o(({row:i})=>[t(c,{direction:"vertical",style:{width:"100%"}},{default:o(()=>[(D(!0),H(R,null,F(i.allowNetworks,V=>(D(),W(L,null,{default:o(()=>[s(k(V),1)]),_:2},1024))),256))]),_:2},1024)]),clientOutletIpsSlot:o(({row:i})=>[t(c,{direction:"vertical",style:{width:"100%"}},{default:o(()=>[(D(!0),H(R,null,F(i.clientOutletIps,V=>(D(),W(L,null,{default:o(()=>[s(k(V),1)]),_:2},1024))),256))]),_:2},1024)]),toolbar:o(()=>[t(h,{type:"primary",onClick:r.addProxyClick},{default:o(()=>[t(_,{type:"layui-icon-add-one"}),e[17]||(e[17]=s(" 新建代理 "))]),_:1},8,["onClick"])]),proxyOperator:o(({row:i})=>[t(h,{size:"xs",type:"danger",onClick:V=>r.proxyDelete(i.remoteHost,i.remotePort)},{default:o(()=>e[18]||(e[18]=[s("删除")])),_:2},1032,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),t(w,{id:"log"},{default:o(()=>[t(y,null,{default:o(()=>[t(M,{to:"#log"},{default:o(()=>[t(P,null,{default:o(()=>[t(_,{type:"layui-icon-link"}),e[19]||(e[19]=s(" 日志监听 "))]),_:1})]),_:1})]),_:1}),t(y,{style:{"margin-top":"10px"}},{default:o(()=>[t(v,{columns:l.logColumns,"data-source":l.logDataSource,autoColsWidth:!0,even:""},{toolbar:o(()=>[t(h,{type:"primary",onClick:r.addLogClick},{default:o(()=>[t(_,{type:"layui-icon-add-one"}),e[20]||(e[20]=s(" 新建监听 "))]),_:1},8,["onClick"])]),logOperator:o(({row:i})=>[t(h,{size:"xs",type:"danger",onClick:V=>r.logDelete(i.filePath)},{default:o(()=>e[21]||(e[21]=[s("删除")])),_:2},1032,["onClick"]),t(h,{size:"xs",type:"normal",onClick:V=>r.logReader(i.filePath)},{default:o(()=>e[22]||(e[22]=[s("查看")])),_:2},1032,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),t(w,{id:"code"},{default:o(()=>[t(y,null,{default:o(()=>[t(M,{to:"#code"},{default:o(()=>[t(P,null,{default:o(()=>[t(_,{type:"layui-icon-link"}),e[23]||(e[23]=s(" 源码管理 "))]),_:1})]),_:1})]),_:1}),t(y,{style:{"margin-top":"10px"}},{default:o(()=>[t(v,{columns:l.codeColumns,"data-source":l.codeDataSource,autoColsWidth:!0,even:""},{toolbar:o(()=>[t(g,{placeholder:"请输入源码类名",modelValue:l.codeSearch,"onUpdate:modelValue":e[3]||(e[3]=i=>l.codeSearch=i),"allow-clear":!0,onClear:r.codeSearchChange,onInput:r.codeSearchChange},{prepend:o(({disabled:i})=>e[24]||(e[24]=[s("类名检索：")])),_:1},8,["modelValue","onClear","onInput"])]),codeOperator:o(({row:i})=>[t(h,{size:"xs",type:"danger",onClick:V=>r.codeReader(i.className)},{default:o(()=>e[25]||(e[25]=[s("源码编辑")])),_:2},1032,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),t(w,{style:{height:"600px","text-align":"center","line-height":"600px"}},{default:o(()=>e[26]||(e[26]=[A("img",{src:J,alt:"Logo"},null,-1)])),_:1}),t(j,{modelValue:l.addProxyOpen,"onUpdate:modelValue":e[9]||(e[9]=i=>l.addProxyOpen=i),shade:!0,area:["400px","530px"],title:"新增代理","title-style":"font-weight: bold;"},{default:o(()=>[A("div",Q,[t(z,{model:l.proxyModel,ref:"proxyModelRef",initValidate:!0},{default:o(()=>[t(I,{label:"远程主机",prop:"remoteHost",required:""},{default:o(()=>[t(g,{modelValue:l.proxyModel.remoteHost,"onUpdate:modelValue":e[4]||(e[4]=i=>l.proxyModel.remoteHost=i)},null,8,["modelValue"])]),_:1}),t(I,{label:"远程端口",prop:"remotePort",required:""},{default:o(()=>[t(g,{modelValue:l.proxyModel.remotePort,"onUpdate:modelValue":e[5]||(e[5]=i=>l.proxyModel.remotePort=i)},null,8,["modelValue"])]),_:1}),t(I,{label:"代理端口",prop:"serverPort"},{default:o(()=>[t(g,{modelValue:l.proxyModel.serverPort,"onUpdate:modelValue":e[6]||(e[6]=i=>l.proxyModel.serverPort=i)},null,8,["modelValue"])]),_:1}),t(I,{label:"允许网段",prop:"allowNetworks"},{default:o(()=>[t(E,{style:{"white-space":"pre-wrap"},placeholder:`例如：
192.168.1.112/32
192.168.1.113/32`,modelValue:l.proxyModel.allowNetworks,"onUpdate:modelValue":e[7]||(e[7]=i=>l.proxyModel.allowNetworks=i)},null,8,["modelValue"]),t(L,{style:{"font-style":"italic","font-size":"small"},type:"warm"},{default:o(()=>e[27]||(e[27]=[s("注意：多网段请换行填写。")])),_:1})]),_:1}),t(I,{label:"备注",prop:"remark"},{default:o(()=>[t(g,{modelValue:l.proxyModel.remark,"onUpdate:modelValue":e[8]||(e[8]=i=>l.proxyModel.remark=i)},null,8,["modelValue"])]),_:1}),t(I,{style:{"text-align":"center"}},{default:o(()=>[t(h,{type:"primary",onClick:r.proxySubmit,style:{width:"100px"}},{default:o(()=>e[28]||(e[28]=[s("新增")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(j,{modelValue:l.addLogOpen,"onUpdate:modelValue":e[12]||(e[12]=i=>l.addLogOpen=i),shade:!0,area:["550px","270px"],title:"新增监听","title-style":"font-weight: bold;"},{default:o(()=>[A("div",X,[t(z,{model:l.logModel,ref:"logModelRef",initValidate:!0},{default:o(()=>[t(I,{label:"日志路径",prop:"filePath",required:""},{default:o(()=>[t(g,{modelValue:l.logModel.filePath,"onUpdate:modelValue":e[10]||(e[10]=i=>l.logModel.filePath=i)},null,8,["modelValue"])]),_:1}),t(I,{label:"监听时长",prop:"expire",required:""},{default:o(()=>[t(g,{modelValue:l.logModel.expire,"onUpdate:modelValue":e[11]||(e[11]=i=>l.logModel.expire=i)},null,8,["modelValue"])]),_:1}),t(I,{style:{"text-align":"center"}},{default:o(()=>[t(h,{type:"primary",onClick:r.logSubmit,style:{width:"100px"}},{default:o(()=>e[29]||(e[29]=[s("新增")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])],64)}const le=G(K,[["render",Y]]);export{le as default};
