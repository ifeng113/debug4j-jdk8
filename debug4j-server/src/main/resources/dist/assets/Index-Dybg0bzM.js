import{a as S,d as T}from"./api-CRUSTNoD.js";import{w as u}from"./webStorage-CD_LUw1r.js";import{_ as G,r as q,f as r,g as B,h as R,b as l,w as o,F as H,e as s,o as D,d,t as _,i as F,a as A,c as W}from"./index-0sD2Tir4.js";import{_ as J}from"./logo--sImDoQO.js";const y=new T,K={setup(){u.getItem("token")===void 0&&q.push("/login");const e=r(""),n=r([]),t=r(""),m=r([]),p=r(""),c=r([]),b=r({}),V=r(!1),h=[{title:"远程主机",width:"150px",key:"remoteHost"},{title:"远程端口",width:"100px",key:"remotePort"},{title:"代理端口",width:"100px",key:"serverPort"},{title:"允许网段",width:"120px",key:"allowNetworks",customSlot:"allowNetworksSlot"},{title:"已连接客户端",width:"120px",key:"clientOutletIps",customSlot:"clientOutletIpsSlot"},{title:"备注",width:"300px",key:"remark",ellipsisTooltip:!0}],O=r([]),I=B({}),N=r(!1),x=r(),U=[{title:"日志路径",width:"150px",key:"filePath"},{title:"监听时长（分钟）",width:"50px",key:"expire"},{title:"操作",width:"50px",customSlot:"logOperator"}],k=r([]),w=B({}),P=r(!1),M=r(),L=r(""),v=[{title:"类名",width:"750px",key:"className"},{title:"操作",width:"50px",customSlot:"codeOperator"}],g=r([]),f=r([]);return{appValue:e,appItem:n,clientIpValue:t,clientIpItem:m,clientIdValue:p,clientIdItem:c,appInfo:b,selectLock:V,proxyColumns:h,proxyDataSource:O,proxyModel:I,addProxyOpen:N,proxyModelRef:x,logColumns:U,logDataSource:k,logModel:w,addLogOpen:P,logModelRef:M,codeSearch:L,codeColumns:v,codeDataSource:g,codeAllDataSource:f}},data(){return{}},methods:{debug(){let a=u.getItem("clients");if(this.clientIdValue!==""){for(let e=0;e<a.length;e++)a[e].uniqueId===this.clientIdValue&&(this.appInfo.socketClientHost=a[e].socketClientHost,this.appInfo.socketClientOutletIp=a[e].socketClientOutletIp,this.appInfo.pid=a[e].pid,this.appInfo.jdwpPort=a[e].jdwpPort,a[e].debug4jMode==="process"?this.appInfo.processSession=a[e].clientSessionId:this.appInfo.threadSession=a[e].clientSessionId);this.selectLock=!this.selectLock,this.selectLock?(this.appInfo.appValue=this.appValue,this.appInfo.appItem=this.appItem,this.appInfo.clientIpValue=this.clientIpValue,this.appInfo.clientIpItem=this.clientIpItem,this.appInfo.clientIdValue=this.clientIdValue,this.appInfo.clientIdItem=this.clientIdItem,this.appInfo.selectLock=this.selectLock,u.setItem("appInfo",this.appInfo),this.loadProxy(),this.loadLog(),this.loadClass()):(this.appInfo.socketClientHost="",this.appInfo.socketClientOutletIp="",this.appInfo.pid="",this.appInfo.jdwpPort="",this.appInfo.processSession="",this.appInfo.threadSession="",u.clear("appInfo"))}},clientIpChange(){let a=u.getItem("clients");this.clientIdValue="",this.clientIdItem=[];for(let e=0;e<a.length;e++)if(a[e].applicationName===this.appValue&&a[e].socketClientIp===this.clientIpValue){let n={label:a[e].uniqueId,value:a[e].uniqueId};this.clientIdItem.some(t=>t.label===n.label&&t.value===n.value)||this.clientIdItem.push(n)}},appChange(){let a=u.getItem("clients");this.clientIpValue="",this.clientIpItem=[],this.clientIdValue="",this.clientIdItem=[];for(let e=0;e<a.length;e++)if(a[e].applicationName===this.appValue){let n={label:a[e].socketClientIp,value:a[e].socketClientIp};this.clientIpItem.some(t=>t.label===n.label&&t.value===n.value)||this.clientIpItem.push(n)}},loadClients(){S.getClients().then(a=>{u.clear("clients"),u.setItem("clients",a.data.data),this.review(),this.loadProxy(),this.loadLog(),this.loadClass();let e=u.getItem("clients");this.appItem=[];for(let n=0;n<e.length;n++){let t={label:e[n].applicationName,value:e[n].applicationName};this.appItem.some(m=>m.label===t.label&&m.value===t.value)||this.appItem.push(t)}}).catch(()=>{y.warning("客户端获取失败，请刷新页面重试！")})},review(){let a=u.getItem("appInfo");if(a!==void 0){let e=u.getItem("clients"),n=!0;for(let t=0;t<e.length;t++)e[t].uniqueId===a.clientIdValue&&(n=!1,e[t].debug4jMode==="process"?a.processSession=e[t].clientSessionId:a.threadSession=e[t].clientSessionId);n||(this.appInfo=a,this.appValue=this.appInfo.appValue,this.appItem=this.appInfo.appItem,this.clientIpValue=this.appInfo.clientIpValue,this.clientIpItem=this.appInfo.clientIpItem,this.clientIdValue=this.appInfo.clientIdValue,this.clientIdItem=this.appInfo.clientIdItem,this.selectLock=this.appInfo.selectLock)}},loadProxy(){this.appInfo.processSession!==void 0&&S.getProxy(this.appInfo.processSession).then(a=>{this.proxyDataSource=a.data.data}).catch(()=>{y.warning("客户端代理获取失败，请刷新页面重试！")})},addProxyClick(){this.addProxyOpen=!this.addProxyOpen,this.proxyModel.remoteHost="",this.proxyModel.remotePort="",this.proxyModel.serverPort="",this.proxyModel.allowNetworks="",this.proxyModel.remark=""},proxySubmit(){this.proxyModelRef.validate((a,e,n)=>{if(a){let t=this.proxyModel;t.allowNetworks=t.allowNetworks.split(`
`),t.clientSessionId=this.appInfo.processSession,S.addProxy(t).then(()=>{this.loadProxy()}).catch(()=>{y.warning("客户端代理新增失败，请重试！")}),this.addProxyClick()}else y.warning("请完整填写代理配置！")})},loadLog(){if(this.appInfo.threadSession!==void 0){let a={clientSessionId:this.appInfo.threadSession};S.getLog(a).then(e=>{this.logDataSource=e.data.data}).catch(()=>{y.warning("日志监听列表获取失败，请刷新页面重试！")})}},addLogClick(){this.addLogOpen=!this.addLogOpen,this.logModel.filePath="",this.logModel.expire=""},logSubmit(){this.logModelRef.validate((a,e,n)=>{if(a){let t=this.logModel;t.clientSessionId=this.appInfo.threadSession,S.addLog(t).then(m=>{let p=!0;for(let c=0;c<m.data.data.length;c++)m.data.data[c].expire===-1&&(y.warning(m.data.data[c].filePath),p=!1);p&&(this.loadLog(),this.addLogClick())}).catch(()=>{y.warning("日志监听新增失败，请重试！")})}else y.warning("请完整填写日志监听配置！")})},logDelete(a){let e={clientSessionId:this.appInfo.threadSession,filePath:a};S.deleteLog(e).then(()=>{this.loadLog()}).catch(()=>{y.warning("日志监听失败失败，请重试！")})},logReader(a){q.push({path:"/log",query:{clientSessionId:this.appInfo.threadSession,filePath:a}})},codeSearchChange(){if(this.codeSearch!==""){this.codeDataSource=[];for(let a=0;a<this.codeAllDataSource.length;a++)if(this.codeAllDataSource[a].className.toLowerCase().includes(this.codeSearch.toLowerCase())){let e=this.codeAllDataSource[a];this.codeDataSource.push(e)}u.setItem("codeSearch",this.codeSearch)}else u.clear("codeSearch"),this.codeDataSource=this.codeAllDataSource},loadClass(){if(this.appInfo.threadSession!==void 0){let a={clientSessionId:this.appInfo.threadSession};S.getCodeClass(a).then(e=>{let n=e.data.data;n.sort();for(let m=0;m<n.length;m++)this.codeAllDataSource.push({className:n[m]});let t=u.getItem("codeSearch");t!==void 0&&(this.codeSearch=t),this.codeSearchChange()}).catch(()=>{y.warning("源码类列表获取失败，请刷新页面重试！")})}},codeReader(a){q.push({path:"/code",query:{clientSessionId:this.appInfo.threadSession,className:a}})}},mounted:function(){this.loadClients()}},Q={style:{padding:"20px"}},X={style:{padding:"20px"}};function Y(a,e,n,t,m,p){const c=s("lay-space"),b=s("lay-select"),V=s("lay-col"),h=s("lay-button"),O=s("lay-badge"),I=s("lay-row"),N=s("lay-line"),x=s("lay-descriptions-item"),U=s("lay-descriptions"),k=s("lay-panel"),w=s("lay-icon"),P=s("lay-quote"),M=s("router-link"),L=s("lay-tag"),v=s("lay-table"),g=s("lay-input"),f=s("lay-form-item"),E=s("lay-textarea"),j=s("lay-form"),z=s("lay-layer");return D(),R(H,null,[l(k,null,{default:o(()=>[l(I,{space:"20"},{default:o(()=>[l(V,{md:"6",sm:"6",xs:"6"},{default:o(()=>[l(c,null,{default:o(()=>[l(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[13]||(e[13]=[d("应用名称：")])),_:1}),l(b,{style:{width:"100%"},modelValue:t.appValue,"onUpdate:modelValue":e[0]||(e[0]=i=>t.appValue=i),items:t.appItem,options:t.appItem,"show-search":!0,onChange:p.appChange,disabled:t.selectLock},null,8,["modelValue","items","options","onChange","disabled"])]),_:1})]),_:1}),l(V,{md:"6",sm:"6",xs:"6"},{default:o(()=>[l(c,null,{default:o(()=>[l(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[14]||(e[14]=[d("客户端IP：")])),_:1}),l(b,{style:{width:"100%"},modelValue:t.clientIpValue,"onUpdate:modelValue":e[1]||(e[1]=i=>t.clientIpValue=i),items:t.clientIpItem,options:t.clientIpItem,"show-search":!0,onChange:p.clientIpChange,disabled:t.selectLock},null,8,["modelValue","items","options","onChange","disabled"])]),_:1})]),_:1}),l(V,{md:"8",sm:"8",xs:"8"},{default:o(()=>[l(c,null,{default:o(()=>[l(c,{style:{"font-weight":"bold",width:"100%","min-width":"70px"}},{default:o(()=>e[15]||(e[15]=[d("客户端ID：")])),_:1}),l(b,{style:{width:"100%"},modelValue:t.clientIdValue,"onUpdate:modelValue":e[2]||(e[2]=i=>t.clientIdValue=i),items:t.clientIdItem,options:t.clientIdItem,disabled:t.selectLock},null,8,["modelValue","items","options","disabled"])]),_:1})]),_:1}),l(V,{md:"4",sm:"4",xs:"4"},{default:o(()=>[l(c,{size:20},{default:o(()=>[l(O,{value:t.selectLock?"debugging":"",ripple:t.selectLock},{default:o(()=>[l(h,{type:t.selectLock?"danger":"primary",onClick:p.debug},{default:o(()=>e[16]||(e[16]=[d("Debug")])),_:1},8,["type","onClick"])]),_:1},8,["value","ripple"])]),_:1})]),_:1})]),_:1}),l(N),l(I,null,{default:o(()=>[l(U,{border:!0,style:{"margin-top":"10px","font-size":"12px"}},{default:o(()=>[l(x,{label:"客户端主机名"},{default:o(()=>[d(_(t.appInfo.socketClientHost),1)]),_:1}),l(x,{label:"客户端外网IP"},{default:o(()=>[d(_(t.appInfo.socketClientOutletIp),1)]),_:1}),l(x,{label:"客户端进程ID"},{default:o(()=>[d(_(t.appInfo.pid),1)]),_:1}),l(x,{label:"远程调试端口"},{default:o(()=>[d(_(t.appInfo.jdwpPort),1)]),_:1}),l(x,{label:"线程通信session"},{default:o(()=>[d(_(t.appInfo.threadSession),1)]),_:1}),l(x,{label:"进程通信session"},{default:o(()=>[d(_(t.appInfo.processSession),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(k,{id:"proxy"},{default:o(()=>[l(I,null,{default:o(()=>[l(M,{to:"#proxy"},{default:o(()=>[l(P,null,{default:o(()=>[l(w,{type:"layui-icon-link"}),e[17]||(e[17]=d(" 代理穿透 "))]),_:1})]),_:1})]),_:1}),l(I,{style:{"margin-top":"10px"}},{default:o(()=>[l(v,{columns:t.proxyColumns,"data-source":t.proxyDataSource,autoColsWidth:!0,even:""},{allowNetworksSlot:o(({row:i})=>[l(c,{direction:"vertical",style:{width:"100%"}},{default:o(()=>[(D(!0),R(H,null,F(i.allowNetworks,C=>(D(),W(L,null,{default:o(()=>[d(_(C),1)]),_:2},1024))),256))]),_:2},1024)]),clientOutletIpsSlot:o(({row:i})=>[l(c,{direction:"vertical",style:{width:"100%"}},{default:o(()=>[(D(!0),R(H,null,F(i.clientOutletIps,C=>(D(),W(L,null,{default:o(()=>[d(_(C),1)]),_:2},1024))),256))]),_:2},1024)]),toolbar:o(()=>[l(h,{type:"primary",onClick:p.addProxyClick},{default:o(()=>[l(w,{type:"layui-icon-add-one"}),e[18]||(e[18]=d(" 新建代理 "))]),_:1},8,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),l(k,{id:"log"},{default:o(()=>[l(I,null,{default:o(()=>[l(M,{to:"#log"},{default:o(()=>[l(P,null,{default:o(()=>[l(w,{type:"layui-icon-link"}),e[19]||(e[19]=d(" 日志监听 "))]),_:1})]),_:1})]),_:1}),l(I,{style:{"margin-top":"10px"}},{default:o(()=>[l(v,{columns:t.logColumns,"data-source":t.logDataSource,autoColsWidth:!0,even:""},{toolbar:o(()=>[l(h,{type:"primary",onClick:p.addLogClick},{default:o(()=>[l(w,{type:"layui-icon-add-one"}),e[20]||(e[20]=d(" 新建监听 "))]),_:1},8,["onClick"])]),logOperator:o(({row:i})=>[l(h,{size:"xs",type:"danger",onClick:C=>p.logDelete(i.filePath)},{default:o(()=>e[21]||(e[21]=[d("删除")])),_:2},1032,["onClick"]),l(h,{size:"xs",type:"normal",onClick:C=>p.logReader(i.filePath)},{default:o(()=>e[22]||(e[22]=[d("查看")])),_:2},1032,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),l(k,{id:"code"},{default:o(()=>[l(I,null,{default:o(()=>[l(M,{to:"#code"},{default:o(()=>[l(P,null,{default:o(()=>[l(w,{type:"layui-icon-link"}),e[23]||(e[23]=d(" 源码管理 "))]),_:1})]),_:1})]),_:1}),l(I,{style:{"margin-top":"10px"}},{default:o(()=>[l(v,{columns:t.codeColumns,"data-source":t.codeDataSource,autoColsWidth:!0,even:""},{toolbar:o(()=>[l(g,{placeholder:"请输入源码类名",modelValue:t.codeSearch,"onUpdate:modelValue":e[3]||(e[3]=i=>t.codeSearch=i),"allow-clear":!0,onClear:p.codeSearchChange,onInput:p.codeSearchChange},{prepend:o(({disabled:i})=>e[24]||(e[24]=[d("类名检索：")])),_:1},8,["modelValue","onClear","onInput"])]),codeOperator:o(({row:i})=>[l(h,{size:"xs",type:"danger",onClick:C=>p.codeReader(i.className)},{default:o(()=>e[25]||(e[25]=[d("源码编辑")])),_:2},1032,["onClick"])]),_:1},8,["columns","data-source"])]),_:1})]),_:1}),l(k,{style:{height:"600px","text-align":"center","line-height":"600px"}},{default:o(()=>e[26]||(e[26]=[A("img",{src:J,alt:"Logo"},null,-1)])),_:1}),l(z,{modelValue:t.addProxyOpen,"onUpdate:modelValue":e[9]||(e[9]=i=>t.addProxyOpen=i),shade:!0,area:["400px","530px"],title:"新增代理","title-style":"font-weight: bold;"},{default:o(()=>[A("div",Q,[l(j,{model:t.proxyModel,ref:"proxyModelRef",initValidate:!0},{default:o(()=>[l(f,{label:"远程主机",prop:"remoteHost",required:""},{default:o(()=>[l(g,{modelValue:t.proxyModel.remoteHost,"onUpdate:modelValue":e[4]||(e[4]=i=>t.proxyModel.remoteHost=i)},null,8,["modelValue"])]),_:1}),l(f,{label:"远程端口",prop:"remotePort",required:""},{default:o(()=>[l(g,{modelValue:t.proxyModel.remotePort,"onUpdate:modelValue":e[5]||(e[5]=i=>t.proxyModel.remotePort=i)},null,8,["modelValue"])]),_:1}),l(f,{label:"代理端口",prop:"serverPort"},{default:o(()=>[l(g,{modelValue:t.proxyModel.serverPort,"onUpdate:modelValue":e[6]||(e[6]=i=>t.proxyModel.serverPort=i)},null,8,["modelValue"])]),_:1}),l(f,{label:"允许网段",prop:"allowNetworks"},{default:o(()=>[l(E,{style:{"white-space":"pre-wrap"},placeholder:`192.168.1.112/32
192.168.1.113/32`,modelValue:t.proxyModel.allowNetworks,"onUpdate:modelValue":e[7]||(e[7]=i=>t.proxyModel.allowNetworks=i)},null,8,["modelValue"]),l(L,{style:{"font-style":"italic","font-size":"small"},type:"warm"},{default:o(()=>e[27]||(e[27]=[d("注意：多网段请换行填写。")])),_:1})]),_:1}),l(f,{label:"备注",prop:"remark"},{default:o(()=>[l(g,{modelValue:t.proxyModel.remark,"onUpdate:modelValue":e[8]||(e[8]=i=>t.proxyModel.remark=i)},null,8,["modelValue"])]),_:1}),l(f,{style:{"text-align":"center"}},{default:o(()=>[l(h,{type:"primary",onClick:p.proxySubmit,style:{width:"100px"}},{default:o(()=>e[28]||(e[28]=[d("新增")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),l(z,{modelValue:t.addLogOpen,"onUpdate:modelValue":e[12]||(e[12]=i=>t.addLogOpen=i),shade:!0,area:["550px","270px"],title:"新增监听","title-style":"font-weight: bold;"},{default:o(()=>[A("div",X,[l(j,{model:t.logModel,ref:"logModelRef",initValidate:!0},{default:o(()=>[l(f,{label:"日志路径",prop:"filePath",required:""},{default:o(()=>[l(g,{modelValue:t.logModel.filePath,"onUpdate:modelValue":e[10]||(e[10]=i=>t.logModel.filePath=i)},null,8,["modelValue"])]),_:1}),l(f,{label:"监听时长",prop:"expire",required:""},{default:o(()=>[l(g,{modelValue:t.logModel.expire,"onUpdate:modelValue":e[11]||(e[11]=i=>t.logModel.expire=i)},null,8,["modelValue"])]),_:1}),l(f,{style:{"text-align":"center"}},{default:o(()=>[l(h,{type:"primary",onClick:p.logSubmit,style:{width:"100px"}},{default:o(()=>e[29]||(e[29]=[d("新增")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])],64)}const le=G(K,[["render",Y]]);export{le as default};
