import{w as y,g as m}from"./webStorage-CD_LUw1r.js";import{_ as b,R as I,r as v,f as n,B as U,c as w,w as c,e as i,o as x,b as e,d as _,t as k}from"./index-DWF53CTv.js";/* empty css                */const L={components:{Codemirror:I},setup(){y.getItem("token")===void 0&&v.push("/login");const t=n(""),S=n(""),o=n(""),C={mode:"log",theme:"darcula",readOnly:!0},s=n(!0),d=n(!0),h=n(0),l=n(0),u=(g,a)=>{d.value?(a.scrollTo(h.value,a.getScrollInfo().height+a.getScrollInfo().top),l.value=a.getScrollInfo().top):a.scrollTo(h.value,l.value)},p=g=>{d.value||(l.value=g.getScrollInfo().top),h.value=g.getScrollInfo().left},f=n();return{clientSessionId:t,filePath:S,code:o,cmOptions:C,es:f,codeUpdate:s,codeScroll:d,onChange:u,onScroll:p}},data(){return{}},methods:{loadLog(){m.baseURL===void 0&&(m.baseURL=window.location.origin),this.es=new EventSource(m.baseURL+"/attach/task?path="+this.filePath+"&sessionId="+this.clientSessionId+"&token="+y.getItem("token")+"&loginId="+y.getItem("loginId")),this.es.onmessage=r=>{this.codeUpdate&&(this.code+=`${r.data}
`)},this.es.onerror=()=>{this.es.close()}},codeUpdateChange(){this.codeUpdate&&(this.code+=`${U(" 日志更新截至："+this.formatTime(new Date)+" ")}
`),this.codeUpdate=!this.codeUpdate},codeScrollChange(){this.codeScroll=!this.codeScroll},codeClear(){this.code=""},formatTime(r){const t={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};return r.toLocaleString("zh-CN",t)}},mounted(){this.clientSessionId=this.$route.query.clientSessionId,this.filePath=this.$route.query.filePath,this.loadLog()},beforeDestroy(){this.es&&this.es.close()}};function B(r,t,S,o,C,s){const d=i("Codemirror"),h=i("lay-body"),l=i("lay-icon"),u=i("lay-button"),p=i("lay-panel"),f=i("lay-footer"),g=i("lay-layout");return x(),w(g,{style:{"background-color":"#444444"}},{default:c(()=>[e(h,{style:{height:"100%"}},{default:c(()=>[e(d,{id:"logBox",value:o.code,"onUpdate:value":t[0]||(t[0]=a=>o.code=a),options:o.cmOptions,onChange:o.onChange,onScroll:o.onScroll,height:"99.6%"},null,8,["value","options","onChange","onScroll"])]),_:1}),e(f,null,{default:c(()=>[e(p,{style:{"margin-bottom":"5px","background-color":"#444444",border:"0"}},{default:c(()=>[e(u,{onClick:s.codeUpdateChange,type:o.codeUpdate?"warm":"primary"},{default:c(()=>[e(l,{type:"layui-icon-refresh"}),_(" "+k(o.codeUpdate?"关闭":"开启")+"更新 ",1)]),_:1},8,["onClick","type"]),e(u,{onClick:s.codeScrollChange,type:o.codeScroll?"warm":"primary"},{default:c(()=>[e(l,{type:"layui-icon-slider"}),_(" "+k(o.codeScroll?"关闭":"开启")+"滚动 ",1)]),_:1},8,["onClick","type"]),e(u,{onClick:s.codeClear,type:"danger"},{default:c(()=>[e(l,{type:"layui-icon-delete"}),t[1]||(t[1]=_(" 清空日志 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const D=b(L,[["render",B]]);export{D as default};
